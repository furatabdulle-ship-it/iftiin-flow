// --------------------
// Translations
// --------------------

const translations = {
  de: {
    nav: {
      about: "Über",
      offerings: "Angebote",
      resources: "Ressourcen",
      newsletter: "Newsletter",
      contact: "Kontakt"
    },
    hero: {
      title: "Digitale & KI-Kompetenzen für eine inklusivere Zukunft.",
      subtitle:
        "Iftiin Flow unterstützt Menschen, Organisationen und Communities dabei, Technologie bewusst, selbstbestimmt und strategisch zu nutzen – für soziale Innovation und inklusivere Strukturen.",
      primaryCta: "Termin buchen",
      secondaryCta: "Digitale Produkte ansehen",
      highlight:
        "„Iftiin“ bedeutet Licht. Iftiin Flow verbindet Digital- und AI Literacy mit Empowerment, damit Technologien nicht nur effizient, sondern auch gerecht und verantwortungsvoll eingesetzt werden."
    },
    about: {
      title: "Was ist Iftiin Flow?",
      intro:
        "Iftiin Flow ist eine Plattform für Digital- und AI Literacy & Enablement. Der Fokus liegt auf einem reflektierten, strategischen Umgang mit Technologie – verbunden mit der Frage, wie digitale Tools soziale Innovationen ermöglichen und Strukturen inklusiver machen können.",
      feature1: {
        title: "Bewusster Umgang mit KI",
        text: "Verstehen, wie KI funktioniert, welche Chancen und Risiken sie mitbringt und wie sie verantwortungsvoll eingesetzt werden kann."
      },
      feature2: {
        title: "Empowerment statt Überforderung",
        text: "Komplexe Themen werden greifbar gemacht – mit praxisnahen Beispielen, klarer Sprache und Formaten, die zum Mitgestalten einladen."
      },
      feature3: {
        title: "Inklusive Perspektiven",
        text: "Technologie wird aus unterschiedlichen Lebensrealitäten gedacht – mit Fokus auf Zugänglichkeit, Gerechtigkeit und Teilhabe."
      },
      feature4: {
        title: "Praktische Tools",
        text: "Konkrete Leitfäden, Checklisten und Formate, die direkt im Alltag, in Teams oder Organisationen angewendet werden können."
      }
    },
    offerings: {
      title: "Angebote",
      intro:
        "Iftiin Flow begleitet Einzelpersonen, Teams und Organisationen – von ersten Schritten mit KI bis hin zu strategischen Enablement-Formaten.",
      moreCta: "Mehr erfahren",
      workshops: {
        title: "Workshops & Trainings",
        short:
          "Interaktive Workshops zu Digital- und AI Literacy – von Grundlagen bis zu konkreten Anwendungsfällen.",
        more:
          "Geeignet für Teams, Organisationen und Communities, die einen gemeinsamen Einstieg in Themen wie KI-Grundlagen, Automatisierung, digitale Zusammenarbeit oder verantwortungsvolle Nutzung neuer Tools suchen. Formate können online oder vor Ort stattfinden und werden auf Zielgruppe, Vorwissen und Kontext zugeschnitten."
      },
      guides: {
        title: "Digitale Guides & Toolkits",
        short:
          "Kompakte PDF-Guides, Checklisten und Tool-Sammlungen für den eigenständigen Einstieg.",
        more:
          "Die digitalen Produkte helfen, Wissen Schritt für Schritt aufzubauen – z. B. zu KI-Basics, guten Prompting-Praktiken, Tool-Übersichten oder Fragen der digitalen Selbstbestimmung. Ideal für Menschen, die selbstgesteuert lernen wollen oder Materialien für ihre Community oder ihr Team suchen."
      },
      consulting: {
        title: "Begleitende Beratung & Enablement",
        short:
          "Strategische Begleitung beim Aufbau von digitalen & KI-Kompetenzen in Teams und Organisationen.",
        more:
          "Gemeinsam werden Bedarfe geklärt, passende Formate entwickelt und Strukturen geschaffen, in denen Lernen nachhaltig möglich ist – von ersten Pilotprojekten bis zu langfristigen Enablement-Programmen. Im Mittelpunkt steht: Technologie soll Menschen dienen, nicht umgekehrt."
      }
    },
    resources: {
      title: "Ressourcen & digitale Produkte",
      intro:
        "Hier findest du erste digitale Produkte von Iftiin Flow – als PDFs zum Download. Ideal für den Einstieg in Digital- und AI Literacy und für die gemeinsame Arbeit in Teams oder Communities.",
      product1: {
        title: "AI Basics Guide für Einsteiger:innen",
        text:
          "Ein verständlicher Einstieg in zentrale KI-Begriffe, Funktionsweisen und Anwendungsfelder – mit Reflexionsfragen und Beispielen aus dem Alltag."
      },
      product2: {
        title: "AI in der Praxis – Mini-Toolkit",
        text:
          "Kurze Übungen, Prompts und Checklisten, um erste eigene Workflows mit KI-Tools bewusst auszuprobieren und zu bewerten."
      },
      product3: {
        title: "Inklusive Tech- & Design-Checkliste",
        text:
          "Checkliste, um digitale Angebote, Workshops oder Tools inklusiver zu gestalten – mit Fokus auf Sprache, Zugänglichkeit und Perspektivenvielfalt."
      },
      downloadCta: "PDF herunterladen"
    },
    newsletter: {
      title: "Newsletter",
      intro:
        "Erhalte Updates zu neuen Guides, Workshops und Ressourcen sowie Einblicke in laufende Projekte rund um Digital- und AI Literacy.",
      emailLabel: "E-Mail-Adresse für den Newsletter",
      emailPlaceholder: "Deine E-Mail-Adresse",
      submitCta: "Newsletter abonnieren",
      success: "Danke für deine Anmeldung! Du erhältst bald eine Bestätigung.",
      error: "Bitte gib eine gültige E-Mail-Adresse ein."
    },
    contact: {
      title: "Kontakt & Erstgespräch",
      intro:
        "Buche ein Erstgespräch, um herauszufinden, wie Iftiin Flow dich, dein Team oder deine Organisation beim Thema Digital- und AI Literacy unterstützen kann.",
      button: "Jetzt Termin buchen",
      emailLabel: "Oder schreib eine E-Mail an "
    },
    footer: {
      copyright: "© Iftiin Flow – Digital & AI Literacy",
      imprint: "Impressum",
      privacy: "Datenschutz",
      socialTitle: "Mehr von Iftiin Flow:"
    }
  },
  en: {
    nav: {
      about: "About",
      offerings: "Offerings",
      resources: "Resources",
      newsletter: "Newsletter",
      contact: "Contact"
    },
    hero: {
      title: "Digital & AI skills for more inclusive futures.",
      subtitle:
        "Iftiin Flow is a platform for digital and AI literacy & enablement. It supports people, organisations and communities in using technology consciously, autonomously and strategically – to drive social innovation and co-create more inclusive structures.",
      primaryCta: "Book a session",
      secondaryCta: "Explore digital products",
      highlight:
        "“Iftiin” means light. Iftiin Flow connects digital & AI literacy with empowerment, so technologies are used not only efficiently – but also justly, responsibly and with awareness of power structures."
    },
    about: {
      title: "What is Iftiin Flow?",
      intro:
        "Iftiin Flow is a platform for digital and AI literacy & enablement. It focuses on reflective, strategic use of technology – always linked to the question: how can digital tools support social innovation and help build more inclusive structures?",
      feature1: {
        title: "Conscious AI use",
        text:
          "Understand how AI works, which opportunities and risks it brings, and how to use it responsibly in everyday contexts."
      },
      feature2: {
        title: "Empowerment, not overwhelm",
        text:
          "Complex topics are translated into clear language, practical examples and formats that invite people to participate instead of feeling left behind."
      },
      feature3: {
        title: "Inclusive perspectives",
        text:
          "Technology is explored through diverse lived experiences – with a focus on accessibility, justice and participation."
      },
      feature4: {
        title: "Practical tools",
        text:
          "Concrete guides, checklists and learning formats that can be applied directly in daily work, teams or community spaces."
      }
    },
    offerings: {
      title: "Offerings",
      intro:
        "Iftiin Flow works with individuals, teams and organisations – from first steps with AI to strategic enablement formats.",
      moreCta: "Learn more",
      workshops: {
        title: "Workshops & Trainings",
        short:
          "Interactive workshops on digital and AI literacy – from fundamentals to concrete use cases.",
        more:
          "Ideal for teams, organisations and communities that want to build a shared understanding of topics like AI basics, automation, digital collaboration or responsible use of new tools. Formats can be delivered online or on site and are adapted to audience, prior knowledge and context."
      },
      guides: {
        title: "Digital Guides & Toolkits",
        short:
          "Compact PDF guides, checklists and tool collections for self-directed learning.",
        more:
          "These digital products help you build knowledge step by step – for example on AI basics, good prompting practices, overviews of tools or questions of digital self-determination. Perfect for people who like to learn at their own pace or share resources with their community or team."
      },
      consulting: {
        title: "Advisory & Enablement Support",
        short:
          "Strategic support for building digital & AI capabilities in teams and organisations.",
        more:
          "We clarify needs, design suitable formats and create structures that make sustainable learning possible – from first pilot projects to long-term enablement programmes. At the centre is one question: technology should serve people, not the other way around."
      }
    },
    resources: {
      title: "Resources & Digital Products",
      intro:
        "Here you’ll find the first digital products by Iftiin Flow – PDFs ready to download. They are designed as an accessible entry point into digital & AI literacy and can be used in teams or community spaces.",
      product1: {
        title: "AI Basics Guide for Beginners",
        text:
          "A clear and friendly introduction to core AI concepts, how models work and where they’re used – including reflection prompts and everyday examples."
      },
      product2: {
        title: "AI in Practice – Mini Toolkit",
        text:
          "Short exercises, prompts and checklists to try your first conscious workflows with AI tools and evaluate what works for you."
      },
      product3: {
        title: "Inclusive Tech & Design Checklist",
        text:
          "A checklist for making digital offers, workshops or tools more inclusive – focusing on language, accessibility and diverse perspectives."
      },
      downloadCta: "Download PDF"
    },
    newsletter: {
      title: "Newsletter",
      intro:
        "Get updates on new guides, workshops and resources – plus insights into ongoing projects around digital & AI literacy.",
      emailLabel: "Email address for the newsletter",
      emailPlaceholder: "Your email address",
      submitCta: "Subscribe",
      success: "Thank you for subscribing! You’ll receive a confirmation soon.",
      error: "Please enter a valid email address."
    },
    contact: {
      title: "Contact & Intro Session",
      intro:
        "Book an intro session to explore how Iftiin Flow can support you, your team or your organisation around digital and AI literacy.",
      button: "Book a call",
      emailLabel: "Or send an email to "
    },
    footer: {
      copyright: "© Iftiin Flow – Digital & AI Literacy",
      imprint: "Imprint",
      privacy: "Privacy",
      socialTitle: "Find Iftiin Flow here:"
    }
  }
};

// --------------------
// Language handling
// --------------------

let currentLang = "de";

function getNestedTranslation(key, lang) {
  const parts = key.split(".");
  let value = translations[lang];
  for (const part of parts) {
    value = value?.[part];
  }
  return value ?? "";
}

function applyTranslations(lang) {
  // Text content
  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    const text = getNestedTranslation(key, lang);
    if (text !== "") {
      el.textContent = text;
    }
  });

  // Placeholders
  document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
    const key = el.getAttribute("data-i18n-placeholder");
    const text = getNestedTranslation(key, lang);
    if (text !== "") {
      el.setAttribute("placeholder", text);
    }
  });
}

function setLanguage(lang) {
  currentLang = lang;
  applyTranslations(lang);
  localStorage.setItem("iftiinflow-lang", lang);

  // Toggle button states
  document.querySelectorAll(".lang-btn").forEach((btn) => {
    const isActive = btn.dataset.lang === lang;
    btn.classList.toggle("active", isActive);
    btn.setAttribute("aria-pressed", isActive ? "true" : "false");
  });
}

// --------------------
// Navigation behaviour
// --------------------

function setupNavToggle() {
  const header = document.querySelector(".site-header");
  const toggleBtn = document.querySelector(".nav-toggle");
  const navLinks = document.querySelectorAll(".nav-link");

  if (!toggleBtn) return;

  toggleBtn.addEventListener("click", () => {
    const isOpen = header.classList.toggle("nav-open");
    toggleBtn.setAttribute("aria-expanded", isOpen ? "true" : "false");
  });

  // Close nav after click on mobile
  navLinks.forEach((link) => {
    link.addEventListener("click", () => {
      if (window.innerWidth < 900) {
        header.classList.remove("nav-open");
        toggleBtn.setAttribute("aria-expanded", "false");
      }
    });
  });
}

// Highlight active section in nav
function setupScrollSpy() {
  const sections = document.querySelectorAll(
    "section[id='hero'], section[id='about'], section[id='offerings'], section[id='resources'], section[id='newsletter'], section[id='contact']"
  );
  const navLinks = document.querySelectorAll(".nav-link");

  if (!sections.length) return;

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        const id = entry.target.getAttribute("id");
        if (entry.isIntersecting) {
          navLinks.forEach((link) => {
            const href = link.getAttribute("href");
            link.classList.toggle("active", href === `#${id}`);
          });
        }
      });
    },
    {
      root: null,
      threshold: 0.4
    }
  );

  sections.forEach((section) => observer.observe(section));
}

// --------------------
// Offerings accordion
// --------------------

function setupOfferingsToggle() {
  const buttons = document.querySelectorAll(
    ".offering-card [data-toggle='details']"
  );

  buttons.forEach((button) => {
    button.addEventListener("click", () => {
      const targetId = button.getAttribute("aria-controls");
      const content = document.getElementById(targetId);
      if (!content) return;
      const isExpanded = button.getAttribute("aria-expanded") === "true";
      button.setAttribute("aria-expanded", (!isExpanded).toString());
      content.hidden = isExpanded;
    });
  });
}

// --------------------
// Newsletter form
// --------------------

function setupNewsletterForm() {
  const form = document.getElementById("newsletter-form");
  const emailInput = document.getElementById("newsletter-email");
  const messageEl = document.getElementById("newsletter-message");

  if (!form || !emailInput || !messageEl) return;

  form.addEventListener("submit", (event) => {
    event.preventDefault();

    const emailValue = emailInput.value.trim();
    const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailValue);

    if (!isValid) {
      messageEl.textContent =
        translations[currentLang].newsletter.error || "";
      messageEl.classList.remove("success");
      messageEl.classList.add("error");
      return;
    }

    // Here you would normally send the data to a backend or service.
    // For now, we just show a success message.
    messageEl.textContent =
      translations[currentLang].newsletter.success || "";
    messageEl.classList.remove("error");
    messageEl.classList.add("success");

    // Keep the email so user can see what they entered
  });
}

// --------------------
// Language toggle setup
// --------------------

function setupLanguageToggle() {
  const saved = localStorage.getItem("iftiinflow-lang");
  const initialLang = saved === "en" ? "en" : "de";
  setLanguage(initialLang);

  document.querySelectorAll(".lang-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const lang = btn.dataset.lang;
      if (lang && lang !== currentLang) {
        setLanguage(lang);
      }
    });
  });
}

// --------------------
// Init
// --------------------

document.addEventListener("DOMContentLoaded", () => {
  setupLanguageToggle();
  setupNavToggle();
  setupScrollSpy();
  setupOfferingsToggle();
  setupNewsletterForm();
});

